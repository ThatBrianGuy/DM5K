@using DM5K.Models
@using DM5K.Helpers
@inject IJSRuntime jsr

<InputHandler CssClass="flex-column token"
              CssStyle="@_tokenStyle"
              OnPressDown="@HandleOnPressDown"
              ID="@string.Format("character-id-{0}", Character.ID)">
    <ChildContent>
        <img src="@Character.Url" draggable="false" alt="Image" height="50" width="50" />
    </ChildContent>
</InputHandler>

@code {
    [CascadingParameter]
    GameCanvas Container { get; set; }

    [Parameter]
    public Character Character { get; set; }

    [Parameter]
    public int TileSize { get; set; }

    private string _tokenStyle { get; set; }

    protected override void OnInitialized()
    {
        SetCharacterPosition();
        base.OnInitialized();
    }

    public void HandleOnPressDown(CanvasEventArgs e)
    {
        Container.DraggedToken = this;
        Container.DraggedTokenStartPosX = this.Character.X;
        Container.DraggedTokenStartPosY = this.Character.Y;
        jsr.InvokeAsync<string>("console.log", string.Format("token mousedown: x: {0}, y: {1}, dx: {2}, dy: {3}", e.StartX, e.StartY, e.DeltaX, e.DeltaY));
    }

    public void SetCharacterPosition()
    {
        _tokenStyle = string.Format("left: {0}px; top: {1}px;", Character.X, Character.Y);
    }
}
